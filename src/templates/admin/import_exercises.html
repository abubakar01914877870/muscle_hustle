{% extends "base.html" %}

{% block title %}Import Exercises - Muscle Hustle{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='design-system.css') }}">

<style>
    .import-header {
        background: linear-gradient(135deg, var(--orange) 0%, var(--color-orange-500) 100%);
        color: var(--color-white);
        padding: var(--space-32);
        margin: calc(var(--space-24) * -1) calc(var(--space-32) * -1) var(--space-32);
        box-shadow: var(--shadow-md);
    }

    .import-title {
        font-size: var(--font-size-3xl);
        font-weight: var(--font-weight-bold);
        margin-bottom: var(--space-8);
    }

    .import-subtitle {
        font-size: var(--font-size-md);
        opacity: 0.9;
    }

    .import-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: var(--space-20);
        margin-bottom: var(--space-32);
    }

    .exercise-card {
        background-color: var(--color-surface);
        border: 1px solid var(--color-card-border);
        border-radius: var(--radius-lg);
        padding: var(--space-20);
        box-shadow: var(--shadow-sm);
        transition: all var(--duration-fast) var(--ease-standard);
    }

    .exercise-card:hover {
        box-shadow: var(--shadow-md);
        transform: translateY(-2px);
    }

    .exercise-name {
        font-size: var(--font-size-lg);
        font-weight: var(--font-weight-semibold);
        color: var(--color-text);
        margin-bottom: var(--space-12);
    }

    .exercise-meta {
        display: flex;
        gap: var(--space-8);
        margin-bottom: var(--space-16);
        flex-wrap: wrap;
    }

    .meta-badge {
        padding: var(--space-4) var(--space-12);
        border-radius: var(--radius-full);
        font-size: var(--font-size-sm);
        background-color: var(--color-secondary);
        color: var(--color-text);
    }

    .import-actions {
        display: flex;
        gap: var(--space-8);
    }

    .btn {
        padding: var(--space-8) var(--space-16);
        border: none;
        border-radius: var(--radius-base);
        font-size: var(--font-size-sm);
        font-weight: var(--font-weight-medium);
        cursor: pointer;
        transition: all var(--duration-fast) var(--ease-standard);
        text-decoration: none;
        display: inline-block;
    }

    .btn-primary {
        background-color: var(--color-primary);
        color: var(--color-btn-primary-text);
    }

    .btn-primary:hover:not(:disabled) {
        background-color: var(--color-primary-hover);
    }

    .btn-secondary {
        background-color: var(--color-secondary);
        color: var(--color-text);
        border: 1px solid var(--color-border);
    }

    .btn-secondary:hover {
        background-color: var(--color-secondary-hover);
    }

    .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .btn-imported {
        background-color: var(--color-success);
        color: var(--color-white);
    }

    .pagination {
        display: flex;
        justify-content: center;
        gap: var(--space-8);
        margin-top: var(--space-32);
    }

    .pagination a,
    .pagination span {
        padding: var(--space-8) var(--space-16);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-base);
        text-decoration: none;
        color: var(--color-text);
    }

    .pagination a:hover {
        background-color: var(--color-secondary-hover);
    }

    .pagination .active {
        background-color: var(--color-primary);
        color: var(--color-white);
        border-color: var(--color-primary);
    }

    .search-container {
        display: flex;
        gap: var(--space-12);
        align-items: center;
        background-color: var(--color-surface);
        padding: var(--space-16);
        border-radius: var(--radius-lg);
        border: 1px solid var(--color-card-border);
        box-shadow: var(--shadow-sm);
    }

    .search-input {
        flex: 1;
        min-width: 200px;
        padding: var(--space-8) var(--space-16);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-base);
        font-size: var(--font-size-md);
        height: 40px;
        /* Explicit height */
    }
</style>

<div class="import-header">
    <h1 class="import-title">Import Exercises from Wger</h1>
    <p class="import-subtitle">Browse and import exercises from the Wger open-source database</p>
</div>

<!-- Search Bar -->
<div style="margin-bottom: var(--space-24);">
    <form method="GET" action="{{ url_for('admin_import.browse') }}" id="searchForm">
        <div class="search-container">
            <input type="text" name="search" id="searchInput" value="{{ search_query }}"
                placeholder="Search exercises by name..." class="search-input">
            <button type="submit" class="btn btn-primary" style="height: 40px;">Search</button>
            {% if search_query %}
            <a href="{{ url_for('admin_import.browse', page=page) }}" class="btn btn-secondary"
                style="height: 40px; display: flex; align-items: center;">Clear</a>
            {% endif %}
        </div>
    </form>
</div>

<div class="import-grid">
    {% for exercise in exercises %}
    <div class="exercise-card" data-exercise-id="{{ exercise.id }}">
        <h3 class="exercise-name">{{ exercise.name }}</h3>
        <div class="exercise-meta">
            <span class="meta-badge">{{ exercise.muscle }}</span>
            <span class="meta-badge">{{ exercise.equipment }}</span>
        </div>
        <div class="import-actions">
            {% if exercise.is_imported %}
            <button class="btn btn-imported" disabled>✓ Imported</button>
            {% else %}
            <a href="{{ url_for('admin_import.prepare_import', exercise_id=exercise.id) }}" class="btn btn-primary">
                Import
            </a>
            {% endif %}
            <button class="btn btn-secondary preview-btn" data-exercise-id="{{ exercise.id }}">
                Preview
            </button>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Pagination -->
<div class="pagination">
    {% if page > 1 %}
    <a href="{{ url_for('admin_import.browse', page=page-1, search=search_query) }}">← Previous</a>
    {% endif %}

    <span class="active">Page {{ page }} of {{ total_pages }}</span>

    {% if page < total_pages %} <a href="{{ url_for('admin_import.browse', page=page+1, search=search_query) }}">Next
        →</a>
        {% endif %}
</div>

<script>


    // Preview exercise
    document.querySelectorAll('.preview-btn').forEach(btn => {
        btn.addEventListener('click', async function () {
            const exerciseId = this.dataset.exerciseId;

            try {
                const response = await fetch(`/admin/import-preview/${exerciseId}`);
                const data = await response.json();

                if (response.ok) {
                    alert(`Name: ${data.name}\nMuscle: ${data.muscle}\nEquipment: ${data.equipment.join(', ')}\n\nDescription: ${data.description.replace(/<[^>]*>/g, '').substring(0, 200)}...`);
                } else {
                    alert(data.error || 'Failed to load preview');
                }
            } catch (error) {
                alert('Error loading preview');
                console.error(error);
            }
        });
    });
</script>

{% endblock %}