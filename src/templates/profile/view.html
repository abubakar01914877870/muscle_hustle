{% extends "base.html" %}

{% block title %}My Profile - Muscle Hustle{% endblock %}

{% block content %}
<!-- Profile Hero Section -->
<section class="profile-hero">
    <div class="profile-image-large" onclick="document.getElementById('profilePictureInput').click()" style="cursor: pointer;">
        {% if user.profile_picture %}
            <img src="{{ user.get_profile_picture_url() }}" alt="Profile Picture">
        {% elif user.full_name %}
            <span>{{ user.full_name.split()[0][0] }}{{ user.full_name.split()[-1][0] if user.full_name.split()|length > 1 else '' }}</span>
        {% else %}
            <span>{{ user.email[0]|upper }}</span>
        {% endif %}
    </div>
    <form id="profilePictureForm" method="POST" action="{{ url_for('profile.upload_picture') }}" enctype="multipart/form-data" style="display: none;">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <input type="file" id="profilePictureInput" name="profile_picture" accept="image/*" onchange="document.getElementById('profilePictureForm').submit();">
    </form>
    <p class="upload-hint">Click image to change profile picture</p>
    {% if user.profile_picture %}
    <form method="POST" action="{{ url_for('profile.remove_picture') }}" style="margin-top: var(--space-8);">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <button type="submit" class="btn btn-secondary" style="font-size: var(--font-size-sm); padding: var(--space-6) var(--space-12);" onclick="return confirm('Remove profile picture?');">Remove Picture</button>
    </form>
    {% endif %}
    <h2 style="font-size: var(--font-size-3xl); margin-bottom: var(--space-8); margin-top: var(--space-16);">{{ user.full_name or user.email }}</h2>
    <p style="color: var(--color-text-secondary); margin-bottom: var(--space-20);">{{ user.email }}</p>
    <div class="profile-actions">
        <a href="{{ url_for('profile.edit_profile') }}" class="btn btn-primary">‚úèÔ∏è Edit Profile</a>
        <a href="{{ url_for('profile.change_password') }}" class="btn btn-secondary">üîí Change Password</a>
    </div>
</section>

<!-- Personal Information -->
<section class="card">
    <div class="section-header">
        <span class="section-icon">üë§</span>
        <h2>Personal Information</h2>
    </div>
    <div class="profile-grid">
        <div class="profile-item">
            <label>Full Name</label>
            <span>{{ user.full_name or 'Not set' }}</span>
        </div>
        <div class="profile-item">
            <label>Email</label>
            <span>{{ user.email }}</span>
        </div>
        <div class="profile-item">
            <label>Date of Birth</label>
            <span>{{ user.date_of_birth.strftime('%B %d, %Y') if user.date_of_birth else 'Not set' }}</span>
        </div>
        <div class="profile-item">
            <label>Age</label>
            <span>{{ user.calculate_age() or 'Not set' }}</span>
        </div>
        <div class="profile-item">
            <label>Gender</label>
            <span>{{ user.gender.title() if user.gender else 'Not set' }}</span>
        </div>
        <div class="profile-item">
            <label>Phone</label>
            <span>{{ user.phone or 'Not set' }}</span>
        </div>
    </div>
</section>

<!-- Physical Measurements -->
<section class="card">
    <div class="section-header">
        <span class="section-icon">üìä</span>
        <h2>Physical Measurements</h2>
    </div>
    <div class="profile-grid">
        <div class="profile-item">
            <label>Height</label>
            <span>{{ user.height ~ ' cm' if user.height else 'Not set' }}</span>
        </div>
        <div class="profile-item">
            <label>Weight</label>
            <span>{{ user.weight ~ ' kg' if user.weight else 'Not set' }}</span>
        </div>
        <div class="profile-item">
            <label>Target Weight</label>
            <span>{{ user.target_weight ~ ' kg' if user.target_weight else 'Not set' }}</span>
        </div>
        {% if user.calculate_bmi() %}
        <div class="profile-item">
            <label>BMI</label>
            <div class="bmi-display" style="margin-top: var(--space-8);">
                <div class="bmi-value">{{ user.calculate_bmi() }}</div>
                <div class="bmi-category">
                    {% set bmi = user.calculate_bmi() %}
                    {% if bmi < 18.5 %}Underweight
                    {% elif bmi < 25 %}Normal
                    {% elif bmi < 30 %}Overweight
                    {% else %}Obese{% endif %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</section>

<!-- Fitness Information -->
<section class="card">
    <div class="section-header">
        <span class="section-icon">üéØ</span>
        <h2>Fitness Information</h2>
    </div>
    <div class="profile-grid">
        <div class="profile-item">
            <label>Fitness Level</label>
            <span>{{ user.fitness_level.replace('_', ' ').title() if user.fitness_level else 'Not set' }}</span>
        </div>
        <div class="profile-item">
            <label>Fitness Goal</label>
            <span>{{ user.fitness_goal.replace('_', ' ').title() if user.fitness_goal else 'Not set' }}</span>
        </div>
        <div class="profile-item">
            <label>Activity Level</label>
            <span>{{ user.activity_level.replace('_', ' ').title() if user.activity_level else 'Not set' }}</span>
        </div>
        <div class="profile-item">
            <label>Workout Frequency</label>
            <span>{{ user.workout_frequency ~ ' days/week' if user.workout_frequency else 'Not set' }}</span>
        </div>
        <div class="profile-item">
            <label>Preferred Workout Time</label>
            <span>{{ user.preferred_workout_time.title() if user.preferred_workout_time else 'Not set' }}</span>
        </div>
    </div>
</section>

<!-- Health Information -->
<section class="card">
    <div class="section-header">
        <span class="section-icon">üè•</span>
        <h2>Health Information</h2>
    </div>
    <div class="profile-item-full" style="margin-bottom: var(--space-16);">
        <label style="font-weight: var(--font-weight-semibold); color: var(--color-text-secondary); font-size: var(--font-size-xs); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: var(--space-8); display: block;">Medical Conditions</label>
        <p style="color: var(--color-text); margin: 0;">{{ user.medical_conditions or 'None specified' }}</p>
    </div>
    <div class="profile-item-full">
        <label style="font-weight: var(--font-weight-semibold); color: var(--color-text-secondary); font-size: var(--font-size-xs); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: var(--space-8); display: block;">Dietary Restrictions</label>
        <p style="color: var(--color-text); margin: 0;">{{ user.dietary_restrictions or 'None specified' }}</p>
    </div>
</section>
{% endblock %}
